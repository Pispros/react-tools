#!/bin/bash

option=$1
element_name=$2 # Component name passed as first parameter while calling the script* // First parameter
another_name=$3 # Second parameter

_showOptions()
{
	echo
	echo "----------------------- HELP -------------------------"
	echo
	echo "synthax : react-ninjamer-tools <option> <element_name> [<element_name>]"
	echo
	echo
	echo "Attention : Make sure you are in your root folder and you do not have unsaved code a file you want to touch with the tool !"
	echo
	echo "------------------------------------------- Options : "
	echo
	echo "--init ----------> without any other parameter to init ninjamer-tools in your project !"
	echo
	echo "-c ----------> generate a component."
	echo
	echo "-s ----------> generate a service."
	echo
	echo "-p ----------> generate a page."
	echo
	echo "-i ----------> import component in a page.[... -i component_name page_name]" 
	echo
}

_initTools()
{
	cd src
	
	_testIfFileExist "components"

	result="$?"

	if [[ $result == 0 ]] 
	then
		mkdir components
	fi

	_testIfFileExist "pages"

	result="$?"

	if [[ $result == 0 ]] 
	then
		mkdir pages
	fi

	_testIfFileExist "services"

	result="$?"

	if [[ $result == 0 ]] 
	then
		mkdir services
	fi

	echo "--------------------------------------"
	echo "react-ninjamer-tools working properly"
	echo "--------------------------------------"
}

_testIfFileExist()
{
	if [[ $2 == "components" ]] 
	then
		cd src/components
	fi

	if [[ $2 == "pages" ]] 
	then
		cd src/pages
	fi

	filelist=`ls`
	for filename in $filelist 
	do
		if [[ $1 == $filename ]]
		then
			cd ..
			cd ..
			return 1
		fi
	done
	cd .. 
	cd ..
	return 0
}

_makeComponent()
{
	cd src/components

	component_name=$1
	mkdir $component_name

	cd $component_name

	cp ~/.reactComponentSample/sample.js ${component_name}'.js'

	cp ~/.reactComponentSample/sample.scss ${component_name}'.scss'

	sed -i 's/sample/'${component_name}'/' ${component_name}'.js'

	sed -i 's/sample/'${component_name}'/' ${component_name}'.scss'

	echo
	echo "Do you want to import it in a page ? [Y]es or [N]o"
	echo
	read response

	if [[ $response == 'Y' ]] 
	then
		echo 
		echo 'Page name ?'
		echo
		read page_name
		_importComponentInPageF "$component_name" "$page_name"
	fi

	echo "--------------------------------"
	echo "Component generated successfully"
	echo "--------------------------------"

	cd ..
}

_makePage()
{
	cd src/pages

	page_name=$1
	mkdir $page_name

	cd $page_name

	cp ~/.reactComponentSample/sample.js ${page_name}'.js'

	cp ~/.reactComponentSample/sample.scss ${page_name}'.scss'

	sed -i 's/sample/'${page_name}'/' ${page_name}'.js'

	sed -i 's/sample/'${page_name}'/' ${page_name}'.scss'

	echo "--------------------------------"
	echo "Page generated successfully"
	echo "--------------------------------"

	cd ..

	cd ..

	sed -i '1 a import '${page_name}' from "./pages/'${page_name}'/'${page_name}'";' App.js # import new component in app.js

	cd ..
}


_generateComponent()
{
	component_name=$1

	path="components"

	if [[ -z $component_name ]] 
		then
			echo 
			echo "----> Missing component name"
			echo
		else
			_testIfFileExist "$component_name" "$path"

			doFileExist=$?

			if [[ $doFileExist -eq 1 ]]
			then
				echo "Component already generated. Do you want to overwrite it ? Y(es)/N(o)"

				read response

				if [[ $response == 'Y' ]]
					 then
					 	cd src/components

						rm -r ${component_name}

						cd .. 
						cd ..

						_makeComponent "$component_name"

						return
					 else

					 	echo "*********************************"
						echo "Component not overwritten"
						echo "*********************************"

						return
				fi

			
			fi

			_makeComponent "$component_name"

	fi
	

	
}

_generatePage()
{
	page_name=$1

	path="pages"

	if [[ -z "$page_name" ]]
	then
		echo
		echo "----> Missing page name"
		echo
	else
		_testIfFileExist "$page_name" "$path"
		

		doFileExist=$?

		if [[ $doFileExist -eq 1 ]]
		then
			echo "Page already generated. Do you want to overwrite it ? Y(es)/N(o)"

			read response

			if [[ $response == 'Y' ]]
				 then
				 	cd src/pages

					rm -r ${page_name}

					cd .. 
					cd ..

					_makePage "$page_name"

					

					return
				 else

				 	echo "*********************************"
					echo "Page not overwritten"
					echo "*********************************"

					return
			fi

			
		fi

		_makePage "$page_name"
	fi
}

_importComponentInPageF()
{

	component_name="$1"

	page_name="$2"

	if [[ -z $component_name || -z $page_name ]] 
		then
			echo "missing Argument(s)"
		else
			
			cd ../

			ls

			sed -i '1 a import '${component_name}' from "../../components/'${component_name}'/'${component_name}'";' ../pages/${page_name}/${page_name}.js

			cd ..

			cd ..
	fi
}

_importComponentInPage()
{

	component_name="$1"

	page_name="$2"

	if [[ -z $component_name || -z $page_name ]] 
		then
			echo "missing Argument(s)"
		else
			
			cd src/components

			ls

			sed -i '1 a import '${component_name}' from "../../components/'${component_name}'/'${component_name}'";' ../pages/${page_name}/${page_name}.js

			cd ..

			cd ..
	fi
}

#echo $component_name

case $option in

	--init) _initTools ;;

	--help) _showOptions ;;

	-c) _generateComponent "$element_name" ;;

	-p) _generatePage "$element_name" ;;

	-i) _importComponentInPage "$element_name" "$another_name";;
	
	*) _showOptions ;;
esac






