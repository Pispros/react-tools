#!/bin/bash

option=$1
element_name=$2 # Component name passed as first parameter while calling the script*
another_name=$3

_showOptions()
{
	echo
	echo "----------------------- HELP -------------------------"
	echo
	echo "synthax : react-ninjamer-tools <option> <element_name> [<element_name>]"
	echo
	echo "------------------------------------------- Options : "
	echo
	echo "--init ----------> without any other parameter to init ninjamer-tools in your project !"
	echo
	echo "-c ----------> generate a component. Make sure you are in 'components' folder"
	echo
	echo "-s ----------> generate a service. Make sure you are in 'services' folder"
	echo
	echo "-p ----------> generate a page. Make sure you are in 'pages' folder"
	echo
	echo "-i ----------> import component in a page. Make sure you are in 'components' folder"
	echo
}

_initTools()
{
	_testIfFileExist "components"

	result="$?"

	if [[ $result == 0 ]] 
	then
		mkdir components
	fi

	_testIfFileExist "pages"

	result="$?"

	if [[ $result == 0 ]] 
	then
		mkdir pages
	fi

	_testIfFileExist "services"

	result="$?"

	if [[ $result == 0 ]] 
	then
		mkdir services
	fi

	echo "--------------------------------------"
	echo "react-ninjamer-tools working properly"
	echo "--------------------------------------"
}

_testIfFileExist()
{
	filelist=`ls`
	for filename in $filelist 
	do
		if [[ $1 == $filename ]]
		then
			return 1
		fi
	done
	return 0
}

_makeComponent()
{
	component_name=$1
	mkdir $component_name

	cd $component_name

	cp ~/reactComponentSample/sample.js ${component_name}'.js'

	cp ~/reactComponentSample/sample.scss ${component_name}'.scss'

	sed -i 's/sample/'${component_name}'/' ${component_name}'.js'

	sed -i 's/sample/'${component_name}'/' ${component_name}'.scss'

	echo "--------------------------------"
	echo "Component generated successfully"
	echo "--------------------------------"

	cd ..
}

_makePage()
{
	page_name=$1
	mkdir $page_name

	cd $page_name

	cp ~/reactComponentSample/sample.js ${page_name}'.js'

	cp ~/reactComponentSample/sample.scss ${page_name}'.scss'

	sed -i 's/sample/'${page_name}'/' ${page_name}'.js'

	sed -i 's/sample/'${page_name}'/' ${page_name}'.scss'

	echo "--------------------------------"
	echo "Page generated successfully"
	echo "--------------------------------"

	cd ..

	cd ..

	sed -i '3 a import '${page_name}' from "./pages/'${page_name}'/'${page_name}'";' App.js # import new component in app.js

	cd pages
}


_generateComponent()
{
	component_name=$1


	if [[ -z $component_name ]] 
		then
			echo 
			echo "----> Missing component name"
			echo
		else
			_testIfFileExist "$component_name"

			doFileExist=$?

			if [[ $doFileExist -eq 1 ]]
			then
				echo "Component already generated. Do you want to overwrite it ? Y(es)/N(o)"

				read response

				if [[ $response == 'Y' ]]
					 then
						rm -r ${component_name}

						_makeComponent "$component_name"

						return
					 else

					 	echo "*********************************"
						echo "Component not overwritten"
						echo "*********************************"

						return
				fi

			
			fi

			_makeComponent "$component_name"

	fi
	

	
}

_generatePage()
{
	page_name=$1

	if [[ -z "$page_name" ]]
	then
		echo
		echo "----> Missing page name"
		echo
	else
		_testIfFileExist "$page_name"

		doFileExist=$?

		if [[ $doFileExist -eq 1 ]]
		then
			echo "Page already generated. Do you want to overwrite it ? Y(es)/N(o)"

			read response

			if [[ $response == 'Y' ]]
				 then
					rm -r ${page_name}

					_makePage "$page_name"

					return
				 else

				 	echo "*********************************"
					echo "Page not overwritten"
					echo "*********************************"

					return
			fi

			
		fi

		_makePage "$page_name"
	fi
}

_importComponentInPage()
{

	component_name="$1"

	page_name="$2"

	if [[ -z $component_name || -z $page_name ]] 
		then
			echo "missing Argument(s)"
		else
			sed -i '3 a import '${component_name}' from "../../components/'${component_name}'/'${component_name}'";' ../pages/${page_name}/${page_name}.js
	fi
}

#echo $component_name

case $option in

	--init) _initTools ;;

	--help) _showOptions ;;

	-c) _generateComponent "$element_name" ;;

	-p) _generatePage "$element_name" ;;

	-i) _importComponentInPage "$element_name" "$another_name";;
	
	*) _showOptions ;;
esac






